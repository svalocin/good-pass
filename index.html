<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="msapplication-TileColor" content="#ffc110">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffc110">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="description" content="好用的密码生成器">

  <title>Good Pass</title>

  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" sizes="57x57" href="img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">

  <link rel="stylesheet" href="css/mustard-ui.min.css">
  <style type="text/css">
    ::-webkit-scrollbar {
      display: none;
    }

    .alert-border {
      border: 1px solid #42a5f5;
    }

    .toggle-password {
      float: right;
      cursor: pointer;
      margin-right: 11px;
      margin-top: -30px;
      width: 20px;
    }
  </style>
</head>

<body style="background: #ffc110;">
  <header style="background: #ffc110;">
    <h1 class="title">Good Pass</h1>
    <h2 class="subtitle">好用的密码生成器</h2>
    <p class="disclaimer">通过一个易于记忆的主体密码和网站的唯一标识为每个网站生成唯一且不能破解的密码</p>
    <button class="get-started button button-primary button-large">开始</button>

    <a class="scroll-down" href="#"></a>
  </header>

  <section style="background: white;">
    <form id="form">
      <div class="form-control">
        <label>密码前缀</label>
        <input id="prefix" type="text" placeholder="">
      </div>

      <div class="form-control">
        <label>主体密码</label>
        <input id="pass" type="password" class="invalid" placeholder="简单易记即可">
        <i class="toggle-password fa fa-fw fa-eye-slash">
          <svg id="pass-show" style="display: none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z"/></svg>
          <svg id="pass-hide" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zm151 118.3C226 97.7 269.5 80 320 80c65.2 0 118.8 29.6 159.9 67.7C518.4 183.5 545 226 558.6 256c-12.6 28-36.6 66.8-70.9 100.9l-53.8-42.2c9.1-17.6 14.2-37.5 14.2-58.7c0-70.7-57.3-128-128-128c-32.2 0-61.7 11.9-84.2 31.5l-46.1-36.1zM394.9 284.2l-81.5-63.9c4.2-8.5 6.6-18.2 6.6-28.3c0-5.5-.7-10.9-2-16c.7 0 1.3 0 2 0c44.2 0 80 35.8 80 80c0 9.9-1.8 19.4-5.1 28.2zm51.3 163.3l-41.9-33C378.8 425.4 350.7 432 320 432c-65.2 0-118.8-29.6-159.9-67.7C121.6 328.5 95 286 81.4 256c8.3-18.4 21.5-41.5 39.4-64.8L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5zm-88-69.3L302 334c-23.5-5.4-43.1-21.2-53.7-42.3l-56.1-44.2c-.2 2.8-.3 5.6-.3 8.5c0 70.7 57.3 128 128 128c13.3 0 26.1-2 38.2-5.8z"/></svg>
        </i>
      </div>

      <div class="form-control grow-2x">
        <label>网站标识</label>
        <input id="mark" type="text" class="invalid" placeholder="建议使用网站域名">
      </div>

      <div class="form-control">
        <label>密码后缀</label>
        <input id="suffix" type="text" placeholder="">
      </div>

      <div class="form-control">
        <label>密码模式</label>
        <select id="mode">
          <option value="mixing" selected="selected">混合</option>
          <option value="lower_mixing">小写混合</option>
          <option value="letters_and_numbers">字母和数字</option>
          <option value="lower_letters_and_numbers">小写字母和数字</option>
          <option value="numbers">数字</option>
        </select>
      </div>

      <div class="form-control">
        <button type="submit" class="button-primary button-large" style="width: 100%; margin-left: 0px;">生成</button>
      </div>

      <div class="form-control">
        <p id="generate" onclick="copy()" class="alert alert-info alert-border" style="text-align: center">
          生成后点击复制
        </p>
      </div>
    </form>
  </section>

  <script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="./js/md5.min.js"></script>
  <script type="text/javascript">
    if (navigator.serviceWorker != null) {
      navigator.serviceWorker.register('sw.js')
        .then(function (registration) {
          console.log('Registered events at scope: ', registration.scope);
        });
    }

    $(function () {
      $(".toggle-password").click(function() {
        input = $(this).parent().find("input");
        if (input.attr("type") == "password") {
          input.attr("type", "text");
          $("#pass-show").show();
          $("#pass-hide").hide();
        } else {
          input.attr("type", "password");
          $("#pass-show").hide();
          $("#pass-hide").show();
        }
      });
      
      $('.get-started').on('click', function (e) {
        e.preventDefault()
        $('html, body').animate({
          scrollTop: $('section:first-of-type').offset().top
        }, 300)
      });

      $(".scroll-down").on('click', function (e) {
        $('html, body').animate({ scrollTop: 0 }, 300);
      });

      var params = getUrlParams();

      $("#prefix").val(params.prefix);
      $("#suffix").val(params.suffix);

      if (params.prefix == undefined || params.prefix == null || params.prefix.trim().length == 0) {
        $("#prefix").val(getItem("prefix"));
      }
      if (params.suffix == undefined || params.suffix == null || params.suffix.trim().length == 0) {
        $("#suffix").val(getItem("suffix"));
      }

      $('#form').on('submit', function (e) {
        e.preventDefault()
        generate();
      });
    });

    function generate() {
      var prefix = strRemoveEmptyAndUpper($("#prefix").val()).toLowerCase();
      var pass = strRemoveEmptyAndUpper($("#pass").val());
      var mark = strRemoveEmptyAndUpper($("#mark").val());
      var mode = $("#mode").val();
      var suffix = strRemoveEmptyAndUpper($("#suffix").val()).toLowerCase();

      debugger;

      if (pass.length == 0) {
        alert("主体密码不能为空");
        return;
      }

      var genPass = processPassword(mode, prefix, md5("GP" + pass + mark).substring(0, 8).toUpperCase(), suffix);
      $("#generate").text(genPass);
      $("#generate").val(genPass);

      setItem("prefix", prefix);
      setItem("suffix", suffix);
    }

    function copy() {
      if ($("#generate").text().trim() == "生成后点击复制") return;

      var generate = document.querySelector('#generate');
      var range = document.createRange();
      range.selectNodeContents(generate);

      var selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);

      try {
        // Now that we've selected the anchor text, execute the copy command
        var successful = document.execCommand('copy');
        alert('复制' + (successful ? '成功' : '失败'));
      } catch (err) {
        console.log('Oops, unable to copy');
      }

      selection.removeAllRanges();
    }

    function strRemoveEmptyAndUpper(str) {
      str = str.replace(/\s/g, "");       //去掉空格
      str = str.replace(/[\r\n]/g, "");   //去掉回车换行
      return str.toUpperCase();
    }

    function getUrlParams() {
      var url = window.location.href;
      var params = {};
      (url + '?').split('?')[1].split('&').forEach(function (pair) {
        pair = (pair + '=').split('=').map(decodeURIComponent);
        if (pair[0].length) {
          params[pair[0]] = pair[1].split('#')[0];
        }
      });
      return params;
    }

    function getItem(key, defaultValue) {
      if (window.localStorage != undefined && window.localStorage != null) {
        let value = localStorage.getItem(key);
        if (value != undefined && value != null) return value;
      }

      return defaultValue == undefined || defaultValue == null ? "" : defaultValue;
    }

    function setItem(key, value) {
      if (window.localStorage != undefined && window.localStorage != null) {
        if (value == undefined || value == null) value = "";
        localStorage.setItem(key, value);
      }
    }

    function processPassword(mode, prefix, generate, suffix) {
      var lettersAndNumbers = "qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM0123456789";

      if (mode == "mixing" || mode == "lower_mixing") {
        generate = prefix + "_" + generate + "_" + suffix;
      }

      if (mode == "letters_and_numbers" || mode == "lower_letters_and_numbers") {
        generate = prefix + "0" + generate + "9" + suffix;

        var _generate = "";
        for (let i = 0; i < generate.length; i++) {
          var e = generate[i];
          if (lettersAndNumbers.indexOf(e) > -1) {
            _generate += e;
          }
        }
        generate = _generate;
      }

      if (mode == "numbers") {
        var _generate = "";
        for (let i = 0; i < generate.length; i++) {
          var e = generate[i];
          _generate += (e.charCodeAt() % 10);
        }
        generate = _generate;
      }

      if (mode == "lower_mixing" || mode == "lower_letters_and_numbers") {
        generate = generate.toLowerCase();
      }

      return generate;
    }
  </script>
</body>

</html>
